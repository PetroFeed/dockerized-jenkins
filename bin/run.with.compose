#!/usr/bin/env bash
set -ex

sum_all() {
  awk '{s+=$1} END {print s}'
}

compose_exit_code() {
  docker-compose ps -q | xargs docker inspect -f '{{ .State.ExitCode }}' | sum_all
}

docker-compose stop && docker-compose build && docker-compose up
exit $(compose_exit_code)
